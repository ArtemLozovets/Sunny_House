@model IEnumerable<Sunny_House.Models.Comment>

@{
    ViewBag.Title = "Отзывы";
}

<h2><i class="fa fa-commenting fa-1x"></i> @ViewBag.Title</h2>

<div class="row">
    <div class="col-md-6" id="resultMessage" style="display:block; height:30px; cursor:pointer">
        <p class="text-success" id="MessageOk"> @TempData["MessageOk"]</p>
        <p class="text-danger" id="MessageError">  @TempData["MessageError"]</p>
    </div>
</div>

@* Панель фильтров --------------------------------- *@
<div class="panel-group">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#collapse1"><span class="text-info">Фильтр</span></a>
            </h4>
        </div>
        <div id="collapse1" class="panel-collapse collapse">
            <div class="panel-body">
                <div class="col-lg-12 form-inline" style="margin-top:2px; margin-bottom:2px;">
                    <div class="input-group" style="width:300px; margin:0 auto">
                        <span class="input-group-addon">От</span>
                        @Html.TextBox("minAge", "0",
                                                new
                                                {
                                                    @style = "width:50px; text-align:center;",
                                                    @type = "text",
                                                    @class = "form-control ",
                                                    @title = "Минимальный возраст",
                                                    @data_val = "true"
                                                })
                        <span class="input-group-addon" style="border-left: 0; border-right: 0;">до</span>
                        @Html.TextBox("maxAge", "100",
                                                new
                                                {
                                                    @style = "width:50px; text-align:center;",
                                                    @type = "text",
                                                    @class = "form-control ",
                                                    @title = "Максимальный возраст",
                                                    @data_val = "true"
                                                })
                        <span class="input-group-addon" style="border-left: 0; border-right: 0;"><span class="glyphicon glyphicon-filter"></span></span>
                        <div class="input-group-btn">
                            <button type="submit" title="Добавить" class="btn btn-toolbar groupbtn" id="addpotentialbtn">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-inline text-center" style="margin-top:8px; margin-bottom:2px;">
                    @using (Ajax.BeginForm("ShowPotentialPartial", "Reserves", new { @EventId = 1 }, new AjaxOptions { UpdateTargetId = "update_potential" }, new { @id = "clientform" }))
                    {
                        <input class="form-control" type="text" name="PTCSearchString" id="PTCSearchString" placeholder="Фамилия, имя, роль..." style="width:200px; margin:2px 0; display:inline-block">
                        <button type="submit" title="Искать" class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
                        @Html.Raw("&nbsp;")<button type="button" title="Обновить" class="btn btn-default" id="clientfilterclear"><i class="glyphicon glyphicon-refresh"></i></button>
                        @Html.Raw("&nbsp;")<a class="btn btn-danger" title="Будет удалена поле тестирования!!!" href='@Url.Action("DeleteAll", "Reserves", new { @EventId = 1 })'><span class="glyphicon glyphicon-remove"> Удалить все</span></a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>



<p>
    <a class="btn btn-default" style="margin:2px 0;" title="Добавить отзыв" href='@Url.Action("CommentCreate", "Comments", new { @PersonId = Request.Params["PersonId"] })'><span class="glyphicon glyphicon-plus"> Добавить отзыв</span></a>
    @Html.Raw("&nbsp;")
    <a class="btn btn-default" style="margin:2px 0;" title="Обновить" href='@Url.Action("CommentShow", "Comments")'><span class="glyphicon glyphicon-refresh"></span></a>
</p>

<table class="table table-bordered table-striped table-responsive table-hover ReestrTable">
    <tr>
        <th>
            Источник
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Date)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Text)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Rating)
        </th>
        <th>
            Подпись
        </th>
        <th>Дополнительно</th>
        <th></th>
    </tr>

    @if (Model.Count() == 0)
    {
        <tr>
            <td colspan="10">
                <p class="text-center text-danger" style="margin-top:12px;">Записи, соответствующие критериям поиска, не найдены<p>
            </td>
        </tr>
    }

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.CommentSource.SourceName)
            </td>
            <td style="text-align:center">
                @Html.DisplayFor(modelItem => item.Date)
            </td>
            <td style="overflow-wrap:break-word; max-width:300px;">
                @Html.DisplayFor(modelItem => item.Text)
            </td>
            <td style="text-align:center">
                @Html.DisplayFor(modelItem => item.Rating)
            </td>
            <td>
                @if (item.SignPersonId != 0)
                {
                    @Html.ActionLink(item.SignPersonFIO, "ShowPersons", "Home", new { PersonId = @item.SignPersonId }, new { target = "_blank" })
                }
            </td>

            <td>
                @if (item.AboutPersonId != 0)
                {
                    <span>
                        О персоне: @Html.ActionLink(item.AboutPersonFIO, "ShowPersons", "Home", new { PersonId = @item.AboutPersonId }, new { target = "_blank" })
                    </span><br />
                }

                @if (item.Event != null)
                {
                    <span>
                        О мероприятии: @Html.ActionLink(item.Event.EventName, "ResShowOfEvent", "Reserves", new { EventId = @item.Event.EventId }, new { target = "_blank" })
                    </span> <br />
                }

                @if (item.Exercise != null)
                {
                    <span>
                        О занятии: @Html.ActionLink(item.Exercise.Subject, "ExDetails", "Exercises", new { ObjectId = @item.Exercise.ExerciseId }, new { target = "_blank" })
                    </span> <br />
                }

                @if (item.Address != null)
                {
                    <span>
                        О месте: @Html.ActionLink(item.Address.Alias, "AdDetails", "Addresses", new { Id = @item.Address.AddressId }, new { target = "_blank" })
                    </span>
                }
            </td>

            <td style="text-align:center; width:136px; min-width:134px;">
                <a class="btn btn-default btn-sm" title="Подробная информация" href='@Url.Action("CommentDetails", "Comments", new { id = item.CommentId })'><span class="glyphicon glyphicon-info-sign"></span></a>
                <a class="btn btn-default btn-sm" title="Редактирование отзыва" href='@Url.Action("CommentEdit", "Comments", new { id = item.CommentId })'><span class="glyphicon glyphicon-edit"></span></a>
                <a class="btn btn-default btn-sm" title="Удаление отзыва" href='@Url.Action("CommentDelete", "Comments", new { id = item.CommentId })'><span class="glyphicon glyphicon-trash"></span></a>
            </td>
        </tr>

    }

</table>

<a href="#" class="scrollup1">Наверх</a>


@section Scripts {
    <script src="~/Scripts/toparrow.js"></script>
    <script type="text/javascript">
        $('body').click(function () {
            $('#resultMessage').fadeOut(1000,
                function () {
                    $('#MessageOk').html('');
                    $('#MessageError').html('');
                    $('#resultMessage').fadeIn(1000)
                });
        });
    </script>
}
