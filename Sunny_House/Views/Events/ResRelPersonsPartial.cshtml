@using PagedList.Mvc;
@model PagedList.IPagedList<Sunny_House.Models.PersonReserveViewModel>
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />

<style type="text/css">
    .lfheader tr th{
        text-align:left;
    }
</style>

<table class="table ReestrTable lfheader" >
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.First().PersonFIO)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.First().PersonRole)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.First().PersonAge)
        </th>
        <th>
        </th>
    </tr>

    @if (Model.Count() == 0)
    {
        <tr>
            <td colspan="3">
                <p class="text-center text-danger" style="margin-top:12px;">Записи, соответствующие критериям поиска, не найдены<p>
            </td>
        </tr>
    }

    @foreach (var item in Model)
    {
        <tr>
            <td>
                <a href="#topanchor" class="showRelPersons EmlRes" data-personid="@item.PersonId" title="Связанные персоны">@Html.DisplayFor(modelItem => item.PersonFIO)</a>
            </td>
            <td>

                @Html.DropDownList("ddl" + @item.PersonId, new SelectList(ViewBag.RoleList, "RoleId", "RoleName", item.RoleId),
                                                        null,
                                                        htmlAttributes: new
                                                        {
                                                            @class = "form-control roleddl",
                                                            style = "width:160px; margin:2px 0; display:inline-block;",
                                                            data_reserveId = item.ReserveId,
                                                            id = "ddl" + item.PersonId
                                                        })

            </td>
            @if (item.PersonAge != null && item.PersonAge > 0)
            {
                <td>
                    <span class="text-info">@Html.DisplayFor(modelItem => item.PersonAge)</span>
                </td>
            }
            else
            {
                <td>
                    @if (item.PersonMonth != null)
                    { <span class="text-success">@Html.DisplayFor(modelItem => item.PersonMonth) мес.</span> }
                </td>
            }
            <td style="min-width:174px; text-align:center;">
                <a class="btn btn-default btn-sm BTPay"
                   title="Добавить платеж"
                   style="display:inline-block;"
                   target="_blank"
                   href='@Url.Action("AddPayment", "Home", new {EventId =  ViewData["EventId"], ClientId = item.PersonId })'>
                    +<span class="glyphicon glyphicon-usd"></span>
                </a>
                <a class="btn btn-default btn-sm" title="Связанные персоны" href='@Url.Action("ShowPersons", "Home",
                new{
                                  PersonId = item.PersonId,
                                  ReturnUrl= "/Reserves/ResShowOfEvent?EventId="+@ViewData["EventId"]
                })'>
                    <span class="glyphicon glyphicon-link"></span>
                </a>

                <a class="btn btn-default btn-sm" title="Отказ" href='@Url.Action("PTCRefusing", "Reserves", new
                                                                 {
                                                                     PersonId = item.PersonId,
                                                                     ReserveId = item.ReserveId,
                                                                     Mode = "Res",
                                                                     EventId = Request.QueryString["EventId"]
                                                                 })'><span class="glyphicon glyphicon-ban-circle"></span></a>

                <a class="btn btn-default btn-sm" title="Удалить бронь" href="#" data-reserveid="@item.ReserveId" id="remreserve">
                    <span class="glyphicon glyphicon-trash"></span>
                </a>

            </td>
        </tr>
    }

</table>

<hr />
Страница @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) из @Model.PageCount

@Html.PagedListPager(Model, page => Url.Action("ResRelPersonsPartial", "Events",
                             new { EventId = Request.QueryString["EventId"], SearchString = @ViewData["SearchString"], page }),
                             PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new PagedListRenderOptions { Display = PagedListDisplayMode.IfNeeded },
                             new AjaxOptions() { HttpMethod = "GET", UpdateTargetId = "update" }))