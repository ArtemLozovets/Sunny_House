@model Sunny_House.Models.Exercise
@{
    ViewBag.Title = "Подробно";
}

<div style="margin-bottom:26px;"><span id="topanchor"></span></div>

<div id="loadingImg">
    <div id="preloadImg">
        <img src="~/Content/Images/loader.gif" />
    </div>
</div>

<div class="row">
    <div class="col-lg-5 col-md-6">
        <div class="panel panel-default fixed" style="min-width:470px;" id="fixedpanel">
            <div class="panel-heading">
                <strong><i class="fa fa-bell"></i> Занятие <em class="text-info"> @Html.DisplayFor(model => model.Subject)</em></strong>
            </div>
            <div class="panel-body">
                <dl class="dl-horizontal">
                    <dt>
                        @Html.DisplayNameFor(model => model.Event.EventName)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.Event.EventName)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.Subject)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.Subject)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.StartTime)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.StartTime)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.EndTime)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.EndTime)
                    </dd>
                    <dt>
                        Место
                    </dt>
                    <dd>
                        @Model.Address.City, @Model.Address.AddressValue
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.Note)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.Note)
                    </dd>
                </dl>

                <div style="margin:10px 0 0 4px;">
                    <a class="btn btn-default" href='@Url.Action("ExShow", "Exercises")'><span class="glyphicon glyphicon-circle-arrow-left"> Назад</span></a>
                    <a class="btn btn-default" href='@Url.Action("ExEdit", "Exercises", new { ObjectId = Model.ExerciseId })'><span class="glyphicon glyphicon-edit"> Редактировать</span></a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-7 col-md-6">
        <div class="panel panel-default" style="min-width:500px; min-height:436px;">
            <div class="panel-heading"><strong><i class="fa fa-bell"></i> Посещения</strong></div>
            <div class="panel-body" id="tabpanel">
                <ul class="nav nav-tabs">
                    @* Вкладки ---------------------------------------------------------------- *@
                    <li id="ResTab" class="active"><a data-toggle="tab" href="#home"><strong>Посетители</strong></a></li>
                    <li id="PTCTab"><a data-toggle="tab" href="#menu1"><strong>Регистрация посещения</strong></a></li>
                </ul>
                <div class="tab-content">
                    @* Вкладка посетителей ------------------------------------------- *@
                    <div id="home" class="tab-pane fade in active">
                        <div class="col-lg-12 form-inline" style="margin-bottom:12px;">
                            @using (Ajax.BeginForm("VisitorPartialList", "Visits", new { @ExerciseId = @Model.ExerciseId }, new AjaxOptions { UpdateTargetId = "update", LoadingElementId = "loadingImg" }, new { @id = "visitform" }))
                            {
                                <input class="form-control" type="text" name="SearchString" id="SearchString" placeholder="Фамилия, имя..." style="width:200px; margin:2px 0; display:inline-block">
                                @Html.DropDownList("RoleSearchString",
                                                        (IEnumerable<SelectListItem>)ViewData["Roles"], "-Роль-",
                                                        htmlAttributes: new
                                                        {
                                                            @class = "form-control",
                                                            style = "width:160px; margin:2px 0; display:inline-block;"
                                                        })
                                <button type="submit" title="Искать" class="btn btn-default" style="margin-top:-3px;"><i class="glyphicon glyphicon-search"></i></button>
                                <button type="button" title="Обновить" class="btn btn-default" id="filterclear" style="margin-top:-3px;"><i class="glyphicon glyphicon-refresh"></i></button>
                            }
                        </div>
                        <div id="update">
                            @Html.Action("VisitorPartialList", "Visits", new { @ExerciseId = @Model.ExerciseId, @SearchString = "", @RoleSearchString = "" })
                        </div>
                    </div>
                    @* Вкладка регистрации ------------------------------------------- *@
                    <div id="menu1" class="tab-pane fade">
                        <h1>Добавить посетителя</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<a href="#" class="scrollup1">Наверх</a>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/circle-progress.min.js"></script>
    <script src="~/Scripts/toparrow.js"></script>

    <script type="text/javascript">
        $(function () {

            //Скрипт сохранения активной панели
            $('body').on('click', 'a[data-toggle="tab"]', function (e) {
                //Сохраняем значение ссылки активной панели
                localStorage.setItem('visitorlastTab', $(this).attr('href'));
            });

            //Открываем сохраненную вкладку если запись существует
            var visitorlastTab = localStorage.getItem('visitorlastTab');
            if (visitorlastTab) {
                $('a[href="' + visitorlastTab + '"]').click();
            }

            $('#SearchString').focus();
            $('#loadingImg').hide();
        });

        $('body').on('click', '#filterclear', function (event) {
            $('#visitform').trigger('reset');
            $('#visitform').submit();
        });

        $(window).resize(function () {
            /*If browser resized, check width again */
            if ($(window).width() >= 1000) {
                $('#fixedpanel').addClass('fixed');
            }
            else { $('#fixedpanel').removeClass('fixed'); }
        });
    </script>
}